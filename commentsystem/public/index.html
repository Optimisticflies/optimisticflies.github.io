<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Comment System with Password Access</title>
  <style>
    body { font-family: sans-serif; }
    #commentSection { display: none; margin-top: 20px; }
    .comment { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
    .reply { margin-left: 20px; border-left: 2px solid #aaa; padding-left: 10px; }
  </style>
</head>
<body>

<h2>Enter Password to Access Comment Section</h2>
<input type="password" id="passwordInput" placeholder="Enter password" />
<button onclick="checkPassword()">Unlock</button>
<p id="error" style="color:red;"></p>

<div id="commentSection">
  <h3>Welcome, <span id="usernameDisplay"></span>!</h3>
  <textarea id="newComment" placeholder="Write a comment..." rows="3" cols="40"></textarea><br>
  <button onclick="postComment()">Post Comment</button>
  
  <div id="comments"></div>
</div>

<script>
  const users = {
    "pass123": "Alice",
    "hunter2": "Bob",
    "letmein": "Charlie"
  };

  let currentUser = null;

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    const error = document.getElementById("error");

    if (users[input]) {
      currentUser = users[input];
      document.getElementById("usernameDisplay").textContent = currentUser;
      document.getElementById("commentSection").style.display = "block";
      document.getElementById("passwordInput").style.display = "none";
      error.textContent = "";
      loadComments();
    } else {
      error.textContent = "Invalid password.";
    }
  }

  async function loadComments() {
    const res = await fetch("/comments");
    const comments = await res.json();
    const commentsDiv = document.getElementById("comments");
    commentsDiv.innerHTML = "";
    comments.forEach(c => {
      const commentDiv = document.createElement("div");
      commentDiv.className = "comment";
      commentDiv.innerHTML = `<strong>${c.user}:</strong> ${c.text}`;
      commentsDiv.appendChild(commentDiv);
    });
  }

  async function postComment() {
    const text = document.getElementById("newComment").value;
    if (!text.trim()) return;

    await fetch("/comments", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ user: currentUser, text })
    });

    document.getElementById("newComment").value = "";
    loadComments();
  }
</script>

</body>
</html>
